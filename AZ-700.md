# [Azure networking documentation](https://docs.microsoft.com/en-us/azure/networking/)

We will divide the Azure Networking services into four major category.

- Connectivity Services
  - [Azure Virtual Network](#azure-virtual-network)
  - Azure Gateways
  - Azure Private Connections
  - Azure Virtual WAN
  - Azure DNS
  - Azure NVA
  - Azure Virtual Network Manager
- Application Delivery Services
  - Network load balancer
  - Web Application load balancer
  - DNS-based load balancer/Azure Traffic Manager
  - Azure Front Door
  - Azure Global load balancer
  - Content delivery network
- Security services
  - [Azure Network firewall](#azure-firewall)
  - Azure Firewal Manager
  - DDoS protection
  - Web application firewall
  - Private Access to a service using private link/private endpoint/ service endpoint
  - Azure Bastion
- Monitoring services
  - Azure Network Watcher
  - Azure Monitor

## [Azure Firewall](https://docs.microsoft.com/en-us/azure/firewall/overview)

[![Video Link](https://docs.microsoft.com/en-us/azure/firewall/media/overview/firewall-standard.png)](https://www.youtube.com/watch?v=JiUerkqyW0g)

Azure Firewall is offered in two SKUs: Standard and Premium.

#### Azure Firewall Standard features

- **Availability Zones**
  - The 99.99% uptime SLA is offered when **_two or more Availability Zones_** are selected. You can also associate Azure Firewall to a specific zone just for proximity reasons, using the service standard 99.95% SLA.
  - No Additional Cost for the availibility Zones but for the traffic.
- **Service tags**
  - A service tag represents a group of IP address prefixes to help minimize complexity for security rule creation. You _can't create your own service tag, nor specify which IP addresses are included within a tag_. Microsoft manages the address prefixes encompassed by the service tag, and automatically updates the service tag as addresses change.
- **Threat intelligence**
  - Intelligence based filtering
- With DNS proxy enabled, Azure Firewall can process and forward DNS queries from a Virtual Network(s) to your desired DNS server.
- Custom DNS allows you to configure Azure Firewall to use your own DNS server, while ensuring the firewall outbound dependencies are still resolved with Azure DNS.
- **FQDN in network rules**
  - The specified FQDNs in your rule collections are translated to IP addresses based on your firewall DNS settings. This capability allows you to filter outbound traffic using FQDNs with any TCP/UDP protocol (including NTP, SSH, RDP, and more). As this capability is based on DNS resolution, it is highly recommended you enable the DNS proxy to ensure name resolution is consistent with your protected virtual machines and firewall.
- Outbound SNAT support
- Inbound DNAT support
- You can associate multiple public IP addresses (up to 250) with your firewall.
- **FQDN tag**
  - An FQDN tag represents a group of **_fully qualified domain names (FQDNs) associated with well known Microsoft services_**.
- **Application FQDN filtering rules**
  - Limit **_outbound HTTP/S traffic or Azure SQL traffic_** to a specified list of fully qualified domain names (FQDN) including wild cards.

#### Azure Firewall Premium features

Azure Firewall Premium provides advanced threat protection that meets the needs of **_highly sensitive and regulated environments, such as the payment and healthcare industries_**.

- **TLS inspection**
  - decrypts outbound traffic, processes the data, then encrypts the data and sends it to the destination.
    ![Azure Standard Firewall](https://docs.microsoft.com/en-us/azure/firewall/media/premium-features/end-to-end-transport-layer-security.png)
    ![Azure Premium Firewall](https://docs.microsoft.com/en-us/azure/firewall/media/premium-features/transport-layer-security-inspection.png)
- **IDPS**
  - A network **_intrusion detection and prevention system (IDPS)_** allows you to monitor network activities for malicious activity, log information about this activity, report it, and optionally attempt to block it.
  - Azure Firewall Premium provides **_signature-based IDPS_** to allow rapid detection of attacks by looking for specific patterns, such as byte sequences in network traffic, or known malicious instruction sequences used by malware. The IDPS signatures are applicable for **_both application and network level traffic (Layers 4-7)_**, they're fully managed, and continuously updated. IDPS can be applied to inbound, spoke-to-spoke (East-West), and outbound traffic. Spoke-to-spoke (East-West) includes traffic that goes from/to an on-premises network.
  - IDPS allows you to detect attacks in all ports and protocols **_for non-encrypted traffic_**. However, when HTTPS traffic needs to be inspected, Azure Firewall can use its TLS inspection capability to decrypt the traffic and better detect malicious activities.
- **URL filtering**
  - extends Azure Firewall’s FQDN filtering capability to consider an entire URL. For example, www.contoso.com/a/c instead of www.contoso.com.
- **Web categories**
  - administrators can allow or deny user access to website categories such as gambling websites, social media websites, and others.

#### Firewall Policy rule sets

![Firewall Policy](https://docs.microsoft.com/en-us/azure/firewall/media/policy-rule-sets/policy-rule-sets.png)

There are three types of rule collections:

- DNAT
  : DNAT rules allow or deny inbound traffic through the firewall public IP address(es). You can use a DNAT rule when you want a public IP address to be translated into a private IP address.
- Network
- Application
  : You can use an application rule when you want to filter traffic based on fully qualified domain names (FQDNs) and HTTP/HTTPS protocols.

Rule collection types must match their parent rule collection group category. For example, a DNAT rule collection can only be part of a DNAT rule collection group.

Rule collections are processed according to the rule type in priority order, lower numbers to higher numbers from 100 to 65,000. If you configure network rules and application rules, then network rules are applied in priority order before application rules.

When IDPS is configured in Alert mode, the IDPS engine works in parallel to the rule processing logic and generates alerts on matching signatures for both inbound and outbound flows.

When IDPS is configured in Alert and Deny mode, the IDPS engine is inline and activated after the rules processing engine. So both engines generate alerts and may block matching flows.

#### Azure Firewall forced tunneling

Azure Firewall provides automatic SNAT for all outbound traffic to public IP addresses. Azure Firewall doesn’t SNAT when the destination IP address is a private IP address range.

With forced tunneling enabled, **_Internet-bound traffic is SNATed to one of the firewall private IP addresses in the AzureFirewallSubnet_**. This hides the source address from your on-premises firewall.

To support forced tunneling, An additional dedicated subnet named AzureFirewallManagementSubnet (minimum subnet size /26) is required with its own associated public IP address. It is used exclusively by the Azure platform and can't be used for any other purpose.

If your organization uses a public IP address range for private networks, Azure Firewall SNATs the traffic to one of the firewall private IP addresses in AzureFirewallSubnet. However, you can configure Azure Firewall to not SNAT your public IP address range. For example, to specify an individual IP address you can specify it like this: 192.168.1.10. To specify a range of IP addresses, you can specify it like this: 192.168.1.0/24.

- To configure Azure Firewall to never SNAT regardless of the destination IP address, use 0.0.0.0/0 as your private IP address range. With this configuration, Azure Firewall can never route traffic directly to the Internet.

- To configure the firewall to always SNAT regardless of the destination address, use 255.255.255.255/32 as your private IP address range.
